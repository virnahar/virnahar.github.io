<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Cosmic Valentine</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Alex+Brush&display=swap');

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #020003; 
            font-family: 'Cinzel', serif;
        }

        /* Glass UI */
        #ui-layer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 40%;
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center;
            pointer-events: none; z-index: 10;
            background: linear-gradient(to top, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%);
            padding-bottom: 40px;
        }

        #text-card {
            text-align: center; color: white; opacity: 0; transform: translateY(30px);
            transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
            max-width: 85%;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }

        #day-tag {
            font-size: 0.7rem; letter-spacing: 6px; color: #ff85a2; 
            text-transform: uppercase; margin-bottom: 5px;
            display: inline-block; border-bottom: 1px solid rgba(255,133,162,0.3); padding-bottom: 3px;
        }

        #headline {
            font-family: 'Alex Brush', cursive;
            font-size: 3.5rem; margin: 5px 0; 
            background: -webkit-linear-gradient(#fff, #ffc3d0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 8px rgba(255,100,150,0.6));
            line-height: 1;
        }

        #sub-text {
            font-size: 0.9rem; margin-top: 10px; color: #ddd;
            font-weight: 100; line-height: 1.5; letter-spacing: 1px;
        }

        /* Start Screen */
        #gate {
            position: fixed; inset: 0; z-index: 100; 
            background: radial-gradient(circle, #1a0510 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: opacity 1.5s ease;
        }

        .star-loader {
            width: 2px; height: 2px; background: white; border-radius: 50%;
            box-shadow: 0 0 10px 2px white;
            animation: twinkle 1s infinite alternate;
            margin-bottom: 20px; transform: scale(3);
        }

        @keyframes twinkle { from { opacity: 0.3; transform: scale(1); } to { opacity: 1; transform: scale(4); } }

        canvas { display: block; }
    </style>
</head>
<body>

    <div id="gate" onclick="enterCosmos()">
        <div class="star-loader"></div>
        <h1 style="font-family:'Cinzel'; font-size: 1.5rem; letter-spacing: 8px; color: #ff85a2;">UNIVERSE</h1>
        <p style="font-size: 0.6rem; letter-spacing: 4px; color: #666; margin-top: 10px;">TAP TO ENTER</p>
    </div>

    <div id="ui-layer">
        <div id="text-card">
            <div id="day-tag"></div>
            <h1 id="headline"></h1>
            <p id="sub-text"></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        let scene, camera, renderer;
        let mainObject, starField, audioCtx;
        let currentStage = -1;
        
        // Configuration
        const heartCount = 4500;  // The morphing object
        const starCount = 3000;   // The background galaxy
        
        const timeline = [
            { day: "Feb 7: Rose Day", title: "Cosmic Bloom", msg: "A rose forged from stardust, unfolding just for you.", color: 0xff0044, type: 'rose' },
            { day: "Feb 8: Propose Day", title: "The Question", msg: "Across every galaxy, I only choose you.", color: 0x00d4ff, type: 'ring' },
            { day: "Feb 9: Chocolate Day", title: "Sweet Gravity", msg: "You pull me in with a sweetness I can't escape.", color: 0xd2691e, type: 'box' },
            { day: "Feb 10: Teddy Day", title: "Soft Nebula", msg: "A gentle embrace in the cold vastness of space.", color: 0xffb7c5, type: 'teddy' },
            { day: "Feb 11: Promise Day", title: "Event Horizon", msg: "A promise that bends time: I will always be yours.", color: 0xffd700, type: 'infinity' },
            { day: "Feb 12: Hug Day", title: "Collision", msg: "Two worlds colliding, merging into one soul.", color: 0x9d4edd, type: 'hug' },
            { day: "Feb 13: Kiss Day", title: "The Spark", msg: "Igniting a supernova in my heart.", color: 0xff0055, type: 'kiss' },
            { day: "Feb 14: Valentine", title: "My Universe", msg: "You are my sun, my moon, and all my stars.", color: 0xff0000, type: 'heart' }
        ];

        // --- AUDIO SYSTEM (Ethereal Synth) ---
        function playSound(index) {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            // Pentatonic Scale frequencies
            const notes = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25];
            const freq = notes[index % notes.length];

            osc.type = 'triangle'; 
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            // Lowpass filter for "underwater/space" sound
            filter.type = "lowpass";
            filter.frequency.value = 800;

            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 0.1);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 3);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
        }

        // --- 3D SCENE SETUP ---
        function enterCosmos() {
            const gate = document.getElementById('gate');
            gate.style.opacity = 0;
            setTimeout(() => gate.remove(), 1500);
            
            initThree();
            nextPhase();
        }

        function initThree() {
            scene = new THREE.Scene();
            // Deep fog for depth
            scene.fog = new THREE.FogExp2(0x050005, 0.002);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.z = 120;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            document.body.appendChild(renderer.domElement);

            createGalaxy();
            createMorphingObject();

            // Ambient Light
            const ambient = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambient);

            // Interaction
            window.addEventListener('click', nextPhase);
            window.addEventListener('touchstart', (e) => { e.preventDefault(); nextPhase(); }, {passive:false});
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            animate();
        }

        // --- BACKGROUND GALAXY ---
        function createGalaxy() {
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(starCount * 3);
            const sizes = new Float32Array(starCount);

            for (let i = 0; i < starCount; i++) {
                // Spherical distribution
                const r = 200 + Math.random() * 800; // Far away
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                
                pos[i*3] = r * Math.sin(phi) * Math.cos(theta);
                pos[i*3+1] = r * Math.sin(phi) * Math.sin(theta);
                pos[i*3+2] = r * Math.cos(phi);
                
                sizes[i] = Math.random() * 2;
            }

            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

            const mat = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1.5,
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true
            });

            starField = new THREE.Points(geo, mat);
            scene.add(starField);
        }

        // --- FOREGROUND MORPHING OBJECT ---
        function createMorphingObject() {
            // Texture for the heart particle
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = "#fff";
            ctx.beginPath();
            ctx.moveTo(16, 28); 
            ctx.bezierCurveTo(16, 28, 4, 20, 4, 11);
            ctx.bezierCurveTo(4, 5, 10, 5, 16, 11);
            ctx.bezierCurveTo(22, 5, 28, 5, 28, 11);
            ctx.bezierCurveTo(28, 20, 16, 28, 16, 28);
            ctx.fill();
            const tex = new THREE.CanvasTexture(canvas);

            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(heartCount * 3);
            
            // Initialize randomness
            for(let i=0; i<heartCount*3; i++) pos[i] = (Math.random()-0.5)*50;
            
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));

            const mat = new THREE.PointsMaterial({
                size: 2.5,
                map: tex,
                color: 0xffffff,
                transparent: true,
                opacity: 0.9,
                depthWrite: false,
                blending: THREE.AdditiveBlending
            });

            mainObject = new THREE.Points(geo, mat);
            scene.add(mainObject);
        }

        // --- MATH SHAPES ---
        function calculateShape(type, i) {
            const rBase = i / heartCount; 
            let x, y, z;

            if (type === 'rose') {
                const theta = rBase * Math.PI * 16;
                const r = rBase * 30;
                x = r * Math.cos(theta);
                y = r * Math.sin(theta);
                z = rBase * 50 - 25;
            } 
            else if (type === 'ring') {
                if (i < heartCount * 0.9) {
                    const t = (i / (heartCount * 0.9)) * Math.PI * 2;
                    x = 30 * Math.cos(t);
                    y = 30 * Math.sin(t);
                    z = (Math.random()-0.5) * 2;
                } else {
                    x = (Math.random()-0.5) * 8;
                    y = 30 + Math.random() * 8;
                    z = (Math.random()-0.5) * 8;
                }
            }
            else if (type === 'box') {
                x = (Math.random()-0.5) * 35;
                y = (Math.random()-0.5) * 35;
                z = (Math.random()-0.5) * 35;
                // Hollow out center roughly
                if (Math.abs(x) < 10 && Math.abs(y) < 10 && Math.abs(z) < 10) x *= 2.5;
            }
            else if (type === 'teddy') {
               const p = Math.random();
               if(p < 0.5) { // Head
                   const t = Math.random()*Math.PI*2, phi = Math.random()*Math.PI;
                   const r = 20;
                   x = r*Math.sin(phi)*Math.cos(t); y = r*Math.sin(phi)*Math.sin(t) + 15; z = r*Math.cos(phi);
               } else if (p < 0.8) { // Body
                   const t = Math.random()*Math.PI*2, phi = Math.random()*Math.PI;
                   const r = 25;
                   x = r*Math.sin(phi)*Math.cos(t); y = r*Math.sin(phi)*Math.sin(t) - 20; z = r*Math.cos(phi);
               } else { // Ears
                   x = (Math.random() > 0.5 ? 18 : -18) + (Math.random()-0.5)*5;
                   y = 30 + (Math.random()-0.5)*5;
                   z = (Math.random()-0.5)*5;
               }
            }
            else if (type === 'infinity') {
                const t = rBase * Math.PI * 2;
                const scale = 2 / (3 - Math.cos(2*t));
                x = scale * Math.cos(t) * 40;
                y = scale * Math.sin(2*t) / 2 * 40;
                z = (Math.random()-0.5) * 5;
            }
            else if (type === 'hug') {
                const t = Math.random() * Math.PI * 2, phi = Math.random() * Math.PI;
                const r = 18;
                // Two spheres offset
                const shift = (i % 2 === 0) ? 12 : -12;
                x = r*Math.sin(phi)*Math.cos(t) + shift;
                y = r*Math.sin(phi)*Math.sin(t);
                z = r*Math.cos(phi);
            }
            else if (type === 'kiss') {
                const t = rBase * Math.PI * 2;
                x = 35 * Math.cos(t);
                y = 15 * Math.sin(t) - 5 * Math.abs(Math.cos(t)) * Math.sin(t); // Lip curve
                z = (Math.random()-0.5) * 5;
            }
            else { // HEART
                const t = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI; 
                // Parametric 3D Heart
                x = 16 * Math.pow(Math.sin(t), 3);
                y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                z = (Math.random()-0.5) * 5; 
                // Scale up
                x *= 2; y *= 2;
            }

            return {x, y, z};
        }

        function nextPhase() {
            currentStage = (currentStage + 1) % timeline.length;
            const data = timeline[currentStage];
            
            playSound(currentStage);

            // UI Update
            const card = document.getElementById('text-card');
            card.style.opacity = 0;
            card.style.transform = "translateY(30px)";

            setTimeout(() => {
                document.getElementById('day-tag').innerText = data.day;
                document.getElementById('headline').innerText = data.title;
                document.getElementById('sub-text').innerText = data.msg;
                document.getElementById('day-tag').style.color = '#' + new THREE.Color(data.color).getHexString();
                
                card.style.opacity = 1;
                card.style.transform = "translateY(0)";
            }, 600);

            // Color Tween
            gsap.to(mainObject.material.color, {
                r: new THREE.Color(data.color).r,
                g: new THREE.Color(data.color).g,
                b: new THREE.Color(data.color).b,
                duration: 2
            });

            // Position Morphing
            const pos = mainObject.geometry.attributes.position.array;
            
            for(let i=0; i<heartCount; i++) {
                const target = calculateShape(data.type, i);
                
                gsap.to(pos, {
                    [i*3]: target.x,
                    [i*3+1]: target.y,
                    [i*3+2]: target.z,
                    duration: 3,
                    ease: "power2.inOut",
                    onUpdate: () => mainObject.geometry.attributes.position.needsUpdate = true
                });
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate Galaxy Background
            if (starField) {
                starField.rotation.y += 0.0005;
                starField.rotation.z += 0.0002;
            }

            // Rotate Morphing Object
            if (mainObject) {
                mainObject.rotation.y += 0.005;
                // Add a gentle "floating" sine wave
                mainObject.position.y = Math.sin(Date.now() * 0.001) * 2;
            }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
