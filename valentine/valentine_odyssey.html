<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stellar Valentine</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Times New Roman', serif; color: #fff; }
        #start-overlay {
            position: fixed; inset: 0; z-index: 100; background: radial-gradient(circle, #1a001a 0%, #000 100%);
            display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        #ui {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            pointer-events: none; z-index: 10; text-align: center;
        }
        .glass-box {
            background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px);
            padding: 40px; border-radius: 50px; border: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0; transform: translateY(30px); transition: all 1.5s ease;
        }
        #title { font-size: 2.5rem; font-weight: 100; margin: 0; color: #ff85a2; }
        #msg { font-size: 1.1rem; font-style: italic; margin-top: 20px; max-width: 300px; line-height: 1.6; opacity: 0.8; }
        .active { opacity: 1 !important; transform: translateY(0) !important; }
    </style>
</head>
<body>

<div id="start-overlay" onclick="begin()">
    <div style="text-align:center;">
        <h1 style="letter-spacing:15px; font-weight:100;">ETERNAL</h1>
        <p style="letter-spacing:3px; opacity:0.5; font-size:0.7rem;">TAP TO ENTER THE GALAXY</p>
    </div>
</div>

<div id="ui">
    <div id="glass" class="glass-box">
        <h1 id="title"></h1>
        <p id="msg"></p>
    </div>
</div>

<script>
let scene, camera, renderer, particles, starPoints, audioCtx, current = -1;
let mouse = new THREE.Vector2(), targetMouse = new THREE.Vector2();

const content = [
    { title: "Day 1", msg: "A soft bloom in the silence of space.", color: 0xff1e56 },
    { title: "The Promise", msg: "Where every star is a word I haven't said yet.", color: 0x00d4ff },
    { title: "The Sweetness", msg: "Melting the coldness of a million miles.", color: 0xffaa00 },
    { title: "One Heart", msg: "I can't show what you mean to me in pixels... but I can give you my universe.", color: 0xff4d6d }
];

function begin() {
    document.getElementById('start-overlay').style.display = 'none';
    document.getElementById('glass').classList.add('active');
    initAudio();
    initThree();
    next();
}

function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    // Background Pad
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(164.81, audioCtx.currentTime); // E3
    g.gain.setValueAtTime(0, audioCtx.currentTime);
    g.gain.linearRampToValueAtTime(0.04, audioCtx.currentTime + 4);
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start();
}

function playSparkle() {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.setValueAtTime(880 + (current * 100), audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + 1);
}

function initThree() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 1000);
    camera.position.z = 120;
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const geo = new THREE.BufferGeometry();
    const pos = [];
    for(let i=0; i<6000; i++) pos.push((Math.random()-0.5)*300, (Math.random()-0.5)*300, (Math.random()-0.5)*300);
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
    
    const mat = new THREE.PointsMaterial({ size: 0.8, transparent: true, blending: THREE.AdditiveBlending, opacity: 0.7 });
    particles = new THREE.Points(geo, mat);
    scene.add(particles);

    window.addEventListener('mousemove', (e) => {
        targetMouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        targetMouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    });

    window.addEventListener('click', next);
    animate();
}

function morph(isHeart) {
    const arr = particles.geometry.attributes.position.array;
    for (let i = 0; i < 6000; i++) {
        let tx, ty, tz;
        if (isHeart) {
            const t = Math.random() * Math.PI * 2;
            tx = 16 * Math.pow(Math.sin(t), 3);
            ty = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
            tz = (Math.random() - 0.5) * 10;
            tx *= 2.5; ty *= 2.5;
        } else {
            const r = 40 + Math.random() * 20;
            const phi = Math.acos(2 * Math.random() - 1);
            const theta = Math.random() * Math.PI * 2;
            tx = r * Math.sin(phi) * Math.cos(theta);
            ty = r * Math.sin(phi) * Math.sin(theta);
            tz = r * Math.cos(phi);
        }

        new TWEEN.Tween(arr)
            .to({ [i*3]: tx, [i*3+1]: ty, [i*3+2]: tz }, 3000)
            .easing(TWEEN.Easing.Quadratic.InOut)
            .start();
    }
}

function next() {
    current = (current + 1) % content.length;
    const data = content[current];
    playSparkle();

    const box = document.getElementById('glass');
    box.classList.remove('active');
    
    setTimeout(() => {
        document.getElementById('title').innerText = data.title;
        document.getElementById('msg').innerText = data.msg;
        box.classList.add('active');
    }, 800);

    new TWEEN.Tween(particles.material.color)
        .to(new THREE.Color(data.color), 2000)
        .start();

    morph(current === 3);
}

function animate(time) {
    requestAnimationFrame(animate);
    TWEEN.update(time);
    
    // Smooth mouse follow
    mouse.x += (targetMouse.x - mouse.x) * 0.05;
    mouse.y += (targetMouse.y - mouse.y) * 0.05;
    
    particles.rotation.y += 0.002 + (mouse.x * 0.01);
    particles.rotation.x += (mouse.y * 0.01);
    
    renderer.render(scene, camera);
}
</script>
</body>
</html>
