<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Symphony of Love</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Parisienne&family=Quicksand:wght@300;500&display=swap');

        body { 
            margin: 0; overflow: hidden; 
            font-family: 'Quicksand', sans-serif;
            background: #1a0b0b; /* Fallback */
            transition: background 2s ease;
        }

        /* Dynamic Background Layer */
        #atmosphere {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at center, #2e1015 0%, #000000 100%);
            transition: opacity 2s ease;
        }

        /* Floating Vignette */
        #vignette {
            position: fixed; inset: 0; pointer-events: none;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.6) 100%);
        }

        /* UI Layer */
        #ui-layer {
            position: fixed; bottom: 10%; width: 100%;
            display: flex; flex-direction: column; align-items: center;
            pointer-events: none; z-index: 10; text-align: center;
        }

        .romance-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px; border-radius: 30px;
            width: 85%; max-width: 450px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            opacity: 0; transform: translateY(30px);
            transition: all 1.2s cubic-bezier(0.25, 1, 0.5, 1);
        }

        #day-label {
            font-size: 0.75rem; letter-spacing: 4px; text-transform: uppercase;
            color: #ffb7c5; margin-bottom: 10px; font-weight: 500;
        }

        #main-title {
            font-family: 'Parisienne', cursive; font-size: 2.8rem; margin: 0;
            color: #fff; text-shadow: 0 0 20px rgba(255,183,197,0.4);
            line-height: 1.2;
        }

        #sub-msg {
            font-size: 1rem; margin-top: 15px; color: #eee; 
            line-height: 1.6; font-weight: 300;
        }

        /* Start Screen */
        #start-screen {
            position: fixed; inset: 0; z-index: 100; 
            background: radial-gradient(circle, #2a0808 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: opacity 1.5s ease;
        }

        .piano-key {
            width: 60px; height: 60px; border-radius: 50%;
            background: white; box-shadow: 0 0 20px rgba(255,255,255,0.5);
            margin-bottom: 20px; animation: breathe 3s infinite ease-in-out;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; color: #ff4d6d;
        }

        @keyframes breathe { 0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255,255,255,0.5); } 50% { transform: scale(1.1); box-shadow: 0 0 40px rgba(255,255,255,0.8); } }

        .active { opacity: 1 !important; transform: translateY(0) !important; }
    </style>
</head>
<body>

    <div id="atmosphere"></div>
    <div id="vignette"></div>

    <div id="start-screen" onclick="startRomance()">
        <div class="piano-key">❤</div>
        <div style="letter-spacing: 4px; font-size: 0.8rem; color: #ffb7c5; opacity: 0.8;">TAP TO PLAY THE MELODY</div>
    </div>

    <div id="ui-layer">
        <div id="card" class="romance-card">
            <div id="day-label"></div>
            <h1 id="main-title"></h1>
            <p id="sub-msg"></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        let scene, camera, renderer, particles;
        let audioCtx, masterGain;
        let currentStep = -1;
        const particleCount = 3500; // Optimized for smoothness

        // --- THE 8 DAYS OF LOVE ---
        const journey = [
            { day: "Feb 7 · Rose Day", title: "Soft Bloom", msg: "Like a rose unfolding, my love grows gently for you.", color: 0xff3366, bg: "#2e0505", shape: "rose" },
            { day: "Feb 8 · Propose Day", title: "Be Mine", msg: "I don't need the world, I just need you in it.", color: 0x00e5ff, bg: "#05182e", shape: "ring" },
            { day: "Feb 9 · Chocolate Day", title: "Sweetness", msg: "You are the sugar that makes life taste better.", color: 0xffaa00, bg: "#2e1c05", shape: "box" },
            { day: "Feb 10 · Teddy Day", title: "Warmth", msg: "A soft embrace to hold you when the world feels cold.", color: 0xffb7c5, bg: "#2e0515", shape: "teddy" },
            { day: "Feb 11 · Promise Day", title: "Forever", msg: "I promise to walk beside you, every step of the way.", color: 0xffd700, bg: "#2e2505", shape: "infinity" },
            { day: "Feb 12 · Hug Day", title: "Closer", msg: "Where you end and I begin, I can no longer tell.", color: 0xaa55ff, bg: "#1a052e", shape: "hug" },
            { day: "Feb 13 · Kiss Day", title: "The Spark", msg: "One touch, and my whole soul lights up.", color: 0xff0055, bg: "#2e0505", shape: "kiss" },
            { day: "Feb 14 · Valentine", title: "My Heart", msg: "You are the music in my silence. I love you.", color: 0xff0000, bg: "#3d0000", shape: "heart" }
        ];

        // --- PIANO ENGINE (Web Audio API) ---
        const Piano = {
            init: function() {
                const AC = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AC();
                masterGain = audioCtx.createGain();
                masterGain.gain.value = 0.5;
                masterGain.connect(audioCtx.destination);
                this.playAmbientPad();
            },

            playAmbientPad: function() {
                // Creates a warm background hum
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = 110; // Low A
                gain.gain.value = 0.05;
                
                const filter = audioCtx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 400;

                osc.connect(filter);
                filter.connect(gain);
                gain.connect(masterGain);
                osc.start();
            },

            playChord: function(step) {
                if(audioCtx.state === 'suspended') audioCtx.resume();
                
                // Romantic Chord Progressions (Major 7ths, Add9s)
                const chords = [
                    [261.6, 329.6, 392.0, 493.9], // C Maj7 (Rose)
                    [293.7, 370.0, 440.0, 554.4], // D Maj7 (Propose)
                    [329.6, 415.3, 493.9, 622.3], // E Maj7 (Chocolate)
                    [349.2, 440.0, 523.3, 659.3], // F Maj7 (Teddy)
                    [392.0, 493.9, 587.3, 740.0], // G Maj7 (Promise)
                    [440.0, 523.3, 659.3, 880.0], // A Min9 (Hug)
                    [493.9, 622.3, 740.0, 987.8], // B Min7 (Kiss)
                    [523.3, 659.3, 784.0, 1046.5] // C Maj9 (Valentine)
                ];

                const notes = chords[step % chords.length];
                const now = audioCtx.currentTime;

                notes.forEach((freq, i) => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    
                    // Mix Sine (Smooth) and Triangle (Body)
                    osc.type = i % 2 === 0 ? 'sine' : 'triangle';
                    osc.frequency.setValueAtTime(freq, now);

                    // Piano Envelope (Fast attack, slow decay)
                    gain.gain.setValueAtTime(0, now);
                    gain.gain.linearRampToValueAtTime(0.15, now + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 2.5);

                    osc.connect(gain);
                    gain.connect(masterGain);
                    osc.start();
                    osc.stop(now + 3);
                });
            }
        };

        // --- 3D VISUALS ---
        function startRomance() {
            gsap.to("#start-screen", { opacity: 0, duration: 1.5, onComplete: () => document.getElementById("start-screen").remove() });
            Piano.init();
            initThree();
            nextStep();
        }

        function initThree() {
            scene = new THREE.Scene();
            // No fog - we want clarity and brightness

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 100;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0); // Transparent to see CSS background
            document.body.appendChild(renderer.domElement);

            // Soft Glow Particle Texture
            const canvas = document.createElement('canvas');
            canvas.width = 32; canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const grad = ctx.createRadialGradient(16,16,0, 16,16,16);
            grad.addColorStop(0, 'rgba(255,255,255,1)');
            grad.addColorStop(0.4, 'rgba(255,255,255,0.3)');
            grad.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = grad;
            ctx.fillRect(0,0,32,32);
            const tex = new THREE.CanvasTexture(canvas);

            // Particle System
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(particleCount * 3);
            for(let i=0; i<particleCount*3; i++) pos[i] = (Math.random()-0.5) * 200;
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));

            const mat = new THREE.PointsMaterial({
                size: 2.0, map: tex, transparent: true, opacity: 0.8,
                blending: THREE.AdditiveBlending, depthWrite: false, color: 0xffffff
            });

            particles = new THREE.Points(geo, mat);
            scene.add(particles);

            // Interaction
            window.addEventListener('click', nextStep);
            window.addEventListener('touchstart', (e) => { e.preventDefault(); nextStep(); }, {passive: false});
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            animate();
        }

        // --- ORGANIC SHAPES ---
        function getShape(type, i) {
            const rBase = i / particleCount;
            let x, y, z;

            switch(type) {
                case 'rose': // Spiral Rose
                    const theta = rBase * Math.PI * 12; 
                    const r = rBase * 30;
                    x = r * Math.cos(theta); 
                    y = r * Math.sin(theta); 
                    z = (rBase * 20) - 10;
                    break;
                case 'ring': // Diamond Ring
                    const tr = 25, tt = rBase * Math.PI * 2;
                    if(i < particleCount * 0.9) {
                        x = tr * Math.cos(tt); y = tr * Math.sin(tt); z = (Math.random()-0.5)*2;
                    } else {
                        x = (Math.random()-0.5)*8; y = 25 + Math.random()*8; z = (Math.random()-0.5)*8;
                    }
                    break;
                case 'box': // Gift Box
                    x=(Math.random()-0.5)*35; y=(Math.random()-0.5)*35; z=(Math.random()-0.5)*35;
                    if(Math.random()>0.4) { 
                        const ax = Math.floor(Math.random()*3);
                        if(ax==0) x=Math.sign(x)*18; else if(ax==1) y=Math.sign(y)*18; else z=Math.sign(z)*18;
                    }
                    break;
                case 'teddy': // Soft Bear
                    const p = Math.random();
                    if(p<0.45){ // Head
                        const t=Math.random()*Math.PI*2, ph=Math.random()*Math.PI;
                        x=18*Math.sin(ph)*Math.cos(t); y=18*Math.sin(ph)*Math.sin(t)+15; z=18*Math.cos(ph);
                    } else if(p<0.85) { // Body
                        const t=Math.random()*Math.PI*2, ph=Math.random()*Math.PI;
                        x=22*Math.sin(ph)*Math.cos(t); y=22*Math.sin(ph)*Math.sin(t)-20; z=22*Math.cos(ph);
                    } else { // Ears
                        x=(Math.random()>0.5?1:-1)*16 + (Math.random()-0.5)*5; y=28+(Math.random()-0.5)*5; z=(Math.random()-0.5)*5;
                    }
                    break;
                case 'infinity': // Loop
                    const ti = rBase * 2 * Math.PI;
                    const scale = 35;
                    const den = 1 + Math.sin(ti)**2;
                    x = scale * Math.cos(ti) / den; 
                    y = scale * Math.sin(ti) * Math.cos(ti) / den; 
                    z = (Math.random()-0.5)*5;
                    break;
                case 'hug': // Two Spheres
                    const th = Math.random()*Math.PI*2, ph=Math.random()*Math.PI;
                    const shift = (i%2==0)?10:-10;
                    x=16*Math.sin(ph)*Math.cos(th)+shift; y=16*Math.sin(ph)*Math.sin(th); z=16*Math.cos(ph);
                    break;
                case 'kiss': // Lips
                    const tk = rBase * Math.PI * 2;
                    x = 30 * Math.cos(tk); y = 12 * Math.sin(tk) - 4 * Math.abs(Math.cos(tk)) * Math.sin(tk); z = (Math.random()-0.5)*5;
                    break;
                case 'heart': // Heart
                    const tht = Math.random()*Math.PI*2;
                    x=16*Math.pow(Math.sin(tht),3); y=13*Math.cos(tht)-5*Math.cos(2*tht)-2*Math.cos(3*tht)-Math.cos(4*tht); z=(Math.random()-0.5)*10;
                    x*=2.0; y*=2.0;
                    break;
            }
            return {x,y,z};
        }

        function nextStep() {
            currentStep = (currentStep + 1) % journey.length;
            const data = journey[currentStep];

            Piano.playChord(currentStep);

            // Change Background Atmosphere (CSS)
            document.getElementById('atmosphere').style.background = `radial-gradient(circle at center, ${data.bg} 0%, #000000 100%)`;

            // UI Transitions
            const card = document.getElementById('card');
            card.classList.remove('active');
            
            setTimeout(() => {
                document.getElementById('day-label').innerText = data.day;
                document.getElementById('main-title').innerText = data.title;
                document.getElementById('sub-msg').innerText = data.msg;
                document.getElementById('day-label').style.color = '#' + new THREE.Color(data.color).getHexString();
                card.classList.add('active');
            }, 500);

            // Particle Transitions (GSAP)
            const posAttr = particles.geometry.attributes.position;
            const targetColor = new THREE.Color(data.color);

            gsap.to(particles.material.color, { r: targetColor.r, g: targetColor.g, b: targetColor.b, duration: 1.5 });

            for(let i=0; i<particleCount; i++) {
                const t = getShape(data.shape, i);
                
                // Elastic easing for "Live/Bouncy" feel
                gsap.to(posAttr.array, {
                    [i*3]: t.x, [i*3+1]: t.y, [i*3+2]: t.z,
                    duration: 2.5,
                    ease: "elastic.out(1, 0.5)", 
                    delay: Math.random() * 0.2, // Slight delay for organic morph
                    onUpdate: () => posAttr.needsUpdate = true
                });
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            
            // Gentle breathing rotation
            particles.rotation.y = Math.sin(time * 0.1) * 0.2;
            particles.rotation.x = Math.cos(time * 0.1) * 0.1;
            
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
